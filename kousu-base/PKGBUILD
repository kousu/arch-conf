pkgname=kousu-base
pkgdesc="Configuration management for kousu"

# load common settings; be aware if you ever split up this repo.
[ -f ../lib/lib.PKGBUILD ] && cp -lf ../lib/lib.PKGBUILD .lib.PKGBUILD
. .lib.PKGBUILD || exit 1

backup=(
  # user-editable config files
  etc/.gitignore
  etc/gitconfig
  etc/locale.conf
)

depends=(
  # Base system
  base
  man-db # the 'man' command
  man-pages # the core linux man pages (kernel, libc, file formats)
  reflector # for updating /etc/pacman.d/mirrorlist
  etckeeper # for tracking /etc/'s changes; (this is redundant with this package itself; but it's a useful redundancy, that helps me figure out what to change)
  pacman-contrib # pactree, pacdiff, etc
  devtools       # makechrootpkg, pkgctl, etc

  # hardware
  linux  # the kernel. on Arch, this is an *optional* package, so that you can install vanilla Arch inside a container.
  dmidecode # reads low-level BIOS information
  hwinfo
  intel-ucode
  amd-ucode # TODO: these two packages have an optional but difficult amount of manaul setup:
            # https://wiki.archlinux.org/title/Microcode#Early_loading
            # basically you need to edit your kernel command line to *prepend* initrd=/boot/amd-ucode.img,/boot/intel-ucode.img,
            # and making that edit by script is tricky. and also in the early boot that path is not always at /boot? ai yi yi
  usbutils

  lvm2
  e2fsprogs
  dosfstools

  sysstat   # iostat, some other things..
  hdparm
  lshw
  lsof
  iftop
  iotop
  powertop
  nethogs
  net-tools # netstat, ifconfig
  #inetutils # for hostname(1); also has telnet(1), rsh(1), and other deprecated commands
  strace

  # CLI
  bash-completion  # lets apps customize tab completion; it's handy for pass(1) and kubectl(1) and some others, but intereferes and is annoying when apps provide incomplete tab completion because it *disables* the default behaviour of files.
  sudo

  # CLI :: Files
  restic
  fdupes
  magic-wormhole

  # CLI :: Network
  openbsd-netcat
  wireguard-tools
  openssh
  innernet
  traceroute
  socat
  rsync
  sshfs
  bind      # for dig
  whois
  tcpdump
  nmap
  geoip
  geoip-database-extra

  # CLI :: Programming
  base-devel
  words

  git
  git-filter-repo
  #git-lfs
  #git-annex

  # archivers
  7zip
  cdrtools
  unrar
  zip
  unzip

  python
  python-pip
  python-wheel
  python-build

  #nodejs
  #npm

  jq
  htmlq

  strip-nondeterminism
  parallel

  # TUI
  vis    # editor
  lua-lpeg # syntax highlighting in vis
  #vim
  #e3    # has e3vi; 23kiB installed

  htop   # resource/process monitor
)

optdepends=(
  'pikaur: [aur] pacman-compatible wrapper which adds the Arch User Repository as a repository'
  'dtach-ng: [aur] it'"'"'s better than tmux'
  # replaces dtach due to bullshit: https://github.com/crigler/dtach/issues/22
  # dtach is building again but I am unconvinced about it's sustainability
)

package() {
  _package

  # it's safe enough to set permissions like this,
  # with an a window of 'unsafe' permissions
  # because we're building in a isolated tree
  # not configuring a live system
  chmod 750 "${pkgdir}"/etc/sudoers.d
  chmod 600 "${pkgdir}"/etc/sudoers.d/*
}
