pkgname=kousu-bootloader-efi
pkgdesc="Configuration management: EFI-style bootloader"
arch=('any')
url="https://github.com/kousu/arch-conf"
groups=(kousu)

_pkgver() {
  [ -r "$startdir"/.pkgver ] && cat "$startdir"/.pkgver || (echo "r$(git rev-list --count HEAD).commit=$(git describe --always --dirty | sed s/-/+/g)")
}
pkgver="$(_pkgver)"
pkgrel=1

conflicts=(
  kousu-bootloader-bios
)

depends=(
  linux
  mkinitcpio
)

optdepends=(
  'systemd: for default ArchLinux boot splash'
)

backup=(
  etc/mkinitcpio.d/linux.preset
)

install="${pkgname}.install"

package() {
  # often PKGBUILDs use install(1) here, because it lets them control permissions
  # but install(1) can't do folders recursively; so instead, just cp -r, and set any permissions directly with chmod
  # that's safe enough: this is *building* a package for later deployment, not installing on a live system where a temporary gap in permissions is a risk
  cp -rp "${startdir}/src/." "${pkgdir}"
}
