pkgname=kousu-desktop-kde
pkgdesc="Configuration management for KDE"

# load common settings; be aware if you ever split up this repo.
[ -f ../lib/lib.PKGBUILD ] && cp -lf ../lib/lib.PKGBUILD .lib.PKGBUILD
. .lib.PKGBUILD || exit 1

depends=(
  kousu-desktop

  ## GUI :: Desktop Environment :: KDE
  #breeze-gtk # themes GTK apps to match the KDE ones..but I don't know how to use it yet.
  plasma-desktop
  plasma-workspace-wallpapers # extra KDE wallpapers
  powerdevil # KDE plugin for power management
  bluedevil  # KDE plugin for Bluetooth
  plasma-pa  # KDE plugin for audio management
  plasma-systemmonitor # KDE task manager (i.e. GUI version of top)
  kscreen    # KDE plugin for screen management? I think?
  vokoscreen # screen recorder
  wl-clipboard # for wl-copy; needed by xclip under Wayland (which KDE uses by default)

  # thse are kde-applications-meta, split out so I can be choosier
  #kde-accessibility-meta
  #kde-education-meta
  kde-graphics-meta
  #kde-multimedia-meta
  #kde-network-meta
  #kde-pim-meta
  kde-sdk-meta
  kde-system-meta
  kde-utilities-meta
  #kdevelop-meta

  discover       # GUI for pacman (cool!)
  packagekit-qt6 #  -> plugin that actually makes it work on Arch

  # for a more interesting DE:
  # install the 'maui' group

  transmission-qt
)

package() {
  _package

  # KDE config files are all 0600, and dirs are 0755
  # this doesn't set that; this sets 0600 for files and 0700 for dirs. But that's probably good enough.
  chmod -R u=rwX,go= "${pkgdir}"/etc/skel/.config/{k*,baloo*}
}

# and then i want to also figure out how/where to set KDE system defaults
# with GTK I know it's 'dconf' or 'gconf' (why are there two? who knows)
# and Firefox defaults too; plus extra Firefox extensions


# To control KDE settings:
# - add a file to src/etc/skel/.config/kdedefaults/
#   you can figure out what you need to edit by making a change in the GUI, then examining ~/.config/{kdeglobals,kwinrc}
#   whatever settings you see, copy them to the corresponding file *under* ~/.config/kdedefaults/.
# To control GTK/GNOME settings:
# - ...
# To control Firefox settings:
# - ...
# To control xsession settings:
# - if you're using sx, or xinit, or ...whazzit ~/.xsession
#
# In general, if you can't figure it out how to write a config file for a given app, you can do:
#   1. cp -r ~/.config A
#   1. make the change in the app's settings/GUI
#   2. cp -r ~/.config B
#   3. diff -ru A/ B/
# This should identify the change.
# Some apps don't use ~/.config, but they're getting rarer.


## Some tricky things that should be documented somewhere:
#
# - src/etc/systemd/system/user@.service: this symlink is the same as `systemctl mask user@.service`.
#   It disables `systemd --user`, an incomplete and buggy feature in systemd that causes more problems
#   than it solves: https://github.com/systemd/systemd/issues/7261
#   XXX this is re-enabled for now: KDE doesn't get along without it, there's some error about dbus-launch :(
